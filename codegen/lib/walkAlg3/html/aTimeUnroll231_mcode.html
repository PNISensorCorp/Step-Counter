<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="20,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">walkStruct</span>] = aTimeUnroll2(<span class="var type1" id="S3T7U6">atime</span>,<span class="var type1" id="S4T2U7">resolution</span>,<span class="mxinfo" id="T1:U4"><span class="mxinfo" id="T1:U5"><span class="var type1" id="S2T1U8">walkStruct</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="20,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,3" id="srcline3"> 3</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T8:U7"><span class="mxinfo" id="T7:U8"><span class="var type1" id="S2T1U13">walkStruct</span>.prevTime</span> &gt; <span class="var type1" id="S3T7U15">atime</span></span> <span class="comment">%if previosu time is greater than current time, then increase count to note wrap</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,4" id="srcline4"> 4</a></span><span class="line">    <span class="comment">% assumes no packets lost, and updates within 2 seconds of each other..</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,5" id="srcline5"> 5</a></span><span class="line">    <span class="mxinfo" id="T7:U11"><span class="mxinfo" id="T7:U12"><span class="var type1" id="S2T1U19">walkStruct</span>.nWrap</span> = <span class="mxinfo" id="T7:U14"><span class="mxinfo" id="T7:U15"><span class="var type1" id="S2T1U23">walkStruct</span>.nWrap</span> + <span class="mxinfo" id="T7:U17">uint16(<span class="mxinfo" id="T9:U18">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="20,6" id="srcline6"> 6</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% set in milliseconds for best storage method</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo" id="T3:U19"><span class="mxinfo" id="T3:U20"><span class="var type1" id="S2T1U31">walkStruct</span>.aTimeUnroll</span> = <span class="mxinfo" id="T3:U22">uint32(<span class="mxinfo" id="T2:U23"><span class="mxinfo" id="T2:U24">(<span class="mxinfo" id="T2:U25"><span class="mxinfo" id="T2:U26"><span class="mxinfo" id="T2:U27">single(<span class="mxinfo" id="T7:U28"><span class="var type1" id="S2T1U43">walkStruct</span>.nWrap</span>)</span>*65535</span>+<span class="mxinfo" id="T2:U30">single(<span class="var type1" id="S3T7U48">atime</span>)</span></span>)*<span class="var type1" id="S4T2U49">resolution</span></span>*1000</span>)</span></span>; <span class="comment">% wrap corrected time scaled in milli seconds</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="20,10" id="srcline10">10</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T8:U33"><span class="mxinfo" id="T3:U34"><span class="var type1" id="S2T1U55">walkStruct</span>.aTimeUnroll</span> &gt; <span class="mxinfo" id="T9:U36">4294967294</span></span> <span class="comment">% max uint32 #</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo" id="T7:U37"><span class="mxinfo" id="T7:U38"><span class="var type1" id="S2T1U61">walkStruct</span>.nWrap</span> = <span class="mxinfo" id="T7:U40">uint16(<span class="mxinfo" id="T9:U41">0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="20,12" id="srcline12">12</a></span><span class="line">    <span class="mxinfo" id="T5:U42"><span class="mxinfo" id="T5:U43"><span class="var type1" id="S2T1U69">walkStruct</span>.timerOverflow</span> = <span class="mxinfo" id="T5:U45">uint8(<span class="mxinfo" id="T9:U46">1</span>)</span></span>; <span class="comment">% sets overflow flag to 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,13" id="srcline13">13</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo" id="T5:U47"><span class="mxinfo" id="T5:U48"><span class="var type1" id="S2T1U78">walkStruct</span>.timerOverflow</span> = <span class="mxinfo" id="T5:U50">uint8(<span class="mxinfo" id="T9:U51">0</span>)</span></span>; <span class="comment">% resets wrapper back to 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,15" id="srcline15">15</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="20,16" id="srcline16">16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="20,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo" id="T7:U52"><span class="mxinfo" id="T7:U53"><span class="var type1" id="S2T1U86">walkStruct</span>.prevTime</span> = <span class="var type1" id="S3T7U88">atime</span></span>;</span></span>
</pre>
